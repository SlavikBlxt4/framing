package com.example.demo.controller;


import com.example.demo.DTO.ServiceResponseDTO;
import com.example.demo.model.ServiceClass;
import com.example.demo.model.User;
import com.example.demo.repository.ServiceClassRepository;
import com.example.demo.service.userService;
import com.example.demo.DTO.TopPhotographerProjection;
import com.example.demo.utils.CustomAuthenticationToken;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.stream.Collectors;

@RestController
@RequestMapping("/api/users")
public class UserController {
    @Autowired
    private userService userService;


    @Autowired
    private ServiceClassRepository serviceRepository;

    @PostMapping("/signup")
    public User insert(@RequestBody User client) {
        return userService.signup(client.getName(), client.getEmail(), client.getPassword_hash(), client.getPhone_number(), client.getRole());
    }

    @PostMapping("/login")
    public String login(@RequestBody User user) {
        return userService.login(user.getEmail(), user.getPassword_hash());
    }


    //listado de todos los servicios DESDE EL PUNTO DE VISTA DEL PROPIO FOTOGRAFO
    @GetMapping("/services")
    public List<ServiceResponseDTO> getServices() {
        List<ServiceClass> services = serviceRepository.findAll();
        return services.stream().map(service -> new ServiceResponseDTO(
                service.getId(),
                service.getName(),
                service.getDescription(),
                service.getPrice(),
                service.getImageUrl(),
                service.getStyle().getName()
        )).collect(Collectors.toList());
    }



    @GetMapping("/top-photographers")
    public List<TopPhotographerProjection> getTop10PhotographersByBookings() {
        return userService.getTop10PhotographersByBookings();   
    }


}
